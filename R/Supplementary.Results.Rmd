---
title: "Supplementary analysis (SMR), Tables and Figures"
author: Kristoffer Wild
date: "`r Sys.Date()`"
output: 
  word_document:
    reference_docx: template.docx
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, eval = T, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
options(digits = 2)
rm(list=ls())
sessionInfo()
# Packages
pacman::p_load("dplyr", "MASS", "brms", "bayestestR", "MCMCglmm", "quantreg","lmerTest", "emmeans", "latex2exp", "DHARMa", "tidybayes", "ggeffects", "bayesplot", "rstanarm", "plotrix", "emmeans", "patchwork", "ggExtra", "sjPlot", "lazerhawk", "kableExtra","flextable", "tidyr")
```
# Results
```{r Bassiana metabolism results, echo = FALSE, include = FALSE}
## pMCMC Function
# Calculates the, p-value or pMCMC value for a posterior distribution
# x The vector for the posterior distribution. Note that this will test the null hypothesis that the parameter of interest is significantly different from 0. 
pmcmc <- function(x){
  2*(1 - max(table(x<0) / nrow(x)))
}

# raw data
bassiana.data <- read.csv("~/Dropbox/energy_sex_reversal/final.analysis.data/Bassiana.finalO2.sexreversal.analysis.data.clean.csv") %>% 
  rename(day =date.dd.mm.yy.,
         time = marker_sample,
         id = bd_liz_id, 
         O2_min = Final_MR_O2_min,
         sex = Geno.pheno,
         mass_g = mass) %>% 
  mutate(ztime = scale(time),
         logMass = scale(log(mass_g), scale = FALSE),
         zstartmass = scale(log(start_mass_g), scale = FALSE),
         zendmass = scale(log(end_mass_g), scale = FALSE))%>% 
  dplyr::select(-X, -Date.Hatched, -MR_O2_min)

################################################
# Calculating SMR - keeping bottom 10% of data #
################################################
bassiana.data <- bassiana.data %>% 
  group_by(match) %>% # match accounts for individual and date
  arrange(O2_min) %>% 
  slice(1:floor(n()*.1))

# Bassiana sample size 
bassiana.sample.size <- bassiana.data %>%
  group_by(id, sex) %>% 
  summarise(n = n()) %>% 
  ungroup() %>% 
  group_by(sex) %>% 
  summarise(n = n()) %>% 
  mutate(total.sample.size = sum(n),
         total.n.samples = 83)

######  SMR rate results Bassiana ######  
# loo comparison
Bas_m1_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Bas_m1_brms_smr")
Bas_m2_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Bas_m2_brms_smr")
bass.loo <- as.data.frame(loo_compare(Bas_m1_brms, Bas_m2_brms))
bass.r2 <- bayes_R2(Bas_m1_brms)

# Metabolism model output table
Bas_m1_table <- lazerhawk::brms_SummaryTable(Bas_m1_brms, round = 2)

# Overall SEX differences in MR
# 1) extract for posteriors values to test like phenotype and like genotype hypothesis
post_Bas_m1 <- posterior_samples(Bas_m1_brms, pars = "^b")

######### Hypothesis testing -  ACCOUNTING FOR INTERACTION BETWEEN SEX AND MASS
## extracting posteriors for interaction of sex and mass
XXf.mass.posterior <- as.array( post_Bas_m1[,"b_logMass"])
XXm.mass.posterior <- as.array(XXf.mass.posterior +  post_Bas_m1[,"b_sexXXm:logMass"]) # sex reversed
XYm.mass.posterior <- as.array(XXf.mass.posterior +  post_Bas_m1[,"b_sexXYm:logMass"])

# H1: Like Phenotype Hypothesis
Bass.Pheno.mass.diff.m1 <- XYm.mass.posterior - XXm.mass.posterior
pmcmc.Pheno.mass.m1 <- as.data.frame(pmcmc(Bass.Pheno.mass.diff.m1))
# H2: Like Genotype Hypothesis
Bass.Geno.mass.diff.m1 <-  XXf.mass.posterior - XXm.mass.posterior 
pmcmc.geno.mass.m1 <- as.data.frame(pmcmc(Bass.Geno.mass.diff.m1))
```
*Supplementary Analysis*
<p>Default priors for all Bayesian models were used. For all population-level (i.e. Fixed effects), the default prior for the intercept is a normal distribution with a mean 0 and standard deviation 10. The default prior for the shape parameter of the intercept was a Student-t distribution with mean 0, scale 2.5, and 3 degrees of freedom. The default prior for residuals (sigma) was a Student-t distribution with mean 0, scale 2.5, and 3 degrees of freedom. The Cholesky factor was used as the default prior for correlations between random effects<p>

<p>We defined standard metabolic rate (SMR) as the the lowest 10% of values of oxygen consumption rate during our overnight trials. Once these data were removed we had a total of  `r bassiana.data %>% nrow()` measurements for `r bassiana.sample.size[1,3]` individuals (male$_{SR}$ XX: *n = `r bassiana.sample.size[2,2]`*, female XX: *n = `r bassiana.sample.size[1,2]`*, male XY: *n = `r bassiana.sample.size[3,2]`*) were recorded. There was a strong scaling relationship between log metabolic rate and log mass (Table S1). Sex-reversed male XX *B. duperreyi* had a scaling relationship that was most like their phenotypic counterparts (male XY - male$_{SR}$ XX; pMCMC = `r pmcmc.Pheno.mass.m1[1,1]`; Table S1) and lower than their genotypic counterparts (female XX - male$_{SR}$ XX; pMCMC = `r pmcmc.geno.mass.m1[1,1]`). For phenotypic males (male$_{SR}$ XX & male XX), this scaling relationship between logmass and metabolism changed similarly across differently sized individuals (Fig. S1). The homogeneous variance model was the most parsimonious ([heteroscedastic model – homoscedastic model] loo: `r bass.loo[2,1]`, SE = `r bass.loo[2,2]`), accounting for `r bass.r2[1,1]`% (95% CI:`r bass.r2[1,3]` - `r bass.r2[1,4]`) of the variation in metabolic rate. <p>
```{r Pogona metabolism results, echo = FALSE, include = FALSE}
# raw data
pogona.data <- read.csv("~/Dropbox/energy_sex_reversal/final.analysis.data/Pogona.finalO2.sexreversal.analysis.data.clean.csv") %>% 
  rename(day =date.dd.mm.yy.,
         time = marker_sample,
         id = bd_liz_id, 
         O2_min = Final_MR_O2_min,
         sex = Geno.pheno,
         mass_g = mass) %>% 
  group_by(sex) %>% 
  mutate(ztime = scale(time),
         logmass = log(mass_g), 
         logMass = scale(log(mass_g), scale = FALSE),
         zstartmass = scale(log(start_mass_g), scale = FALSE),
         zendmass = scale(log(end_mass_g), scale = FALSE)) %>% 
  dplyr::select(-X, -Date.Hatched, -MR_O2_min)

################################################
# Calculating SMR - keeping bottom 10% of data #
################################################
pogona.data <- pogona.data %>% 
  group_by(match) %>% # match accounts for individual and date
  arrange(O2_min) %>% 
  slice(1:floor(n()*.1))

# sample size 
pogona.sample.size <- pogona.data %>%
  group_by(id, sex) %>% 
  summarise(n = n()) %>% 
  ungroup() %>% 
  group_by(sex) %>% 
  summarise(n = n()) %>% 
  mutate(total.n.individuals = sum(n),
         total.n.samples = 146)

######  SMR rate Pogona ######  
# loo comparison
Pog_m1_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Pog_m1_brms_smr")
Pog_m2_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Pog_m2_brms_smr")
pog.loo <- loo_compare(Pog_m2_brms,Pog_m1_brms)
pog.r2 <- bayes_R2(Pog_m2_brms)

# Metabolism model output table
Pog_m2_table <- lazerhawk::brms_SummaryTable(Pog_m2_brms, round = 2)

# 1) extract for posteriors values to test like phenotype and like genotype hypothesis
post_Pog_m2 <- posterior_samples(Pog_m2_brms, pars = "^b")

######### Hypothesis testing -  ACCOUNTING FOR INTERACTION BETWEEN SEX AND MASS
## extracting posteriors for interaction of sex and mass
ZWf.mass.posterior <- as.array( post_Pog_m2[,"b_logMass"])
ZZf.mass.posterior <- as.array(ZWf.mass.posterior +  post_Pog_m2[,"b_sexZZf:logMass"]) # sex reversed
ZZm.mass.posterior <- as.array(ZWf.mass.posterior +  post_Pog_m2[,"b_sexZZm:logMass"])

pmcmc <- function(x){
  2*(1 - max(table(x<0) / nrow(x)))
}
# H1: Like Phenotype Hypothesis
Pog.Pheno.mass.diff.m2 <- ZWf.mass.posterior - ZZf.mass.posterior
pmcmc.Pheno.mass.m2 <- as.data.frame(pmcmc(Pog.Pheno.mass.diff.m2))

# H2: Like Genotype Hypothesis
Pog.Geno.mass.diff.m2 <-  ZZm.mass.posterior - ZZf.mass.posterior 
pmcmc.geno.mass.m2 <- as.data.frame(pmcmc(Pog.Geno.mass.diff.m2))

```
<p>*Pogona vitticeps* - Once SMR data (lowest 10%) were filtered we had a total of total of `r pogona.data %>% nrow()` measurements for `r pogona.sample.size[1,3]` individuals (female$_{SR}$ ZZ: *n = `r pogona.sample.size[2,2]`*, female ZW: *n = `r pogona.sample.size[1,2]`*, male ZZ: *n = `r pogona.sample.size[3,2]`*) were recorded. There was a strong scaling relationship between log metabolic rate and log mass (Table S2). Sex-reversed female *P. vitticeps* (female$_{SR}$ ZZ) had a scaling relationship that was overall higher than their genotypic counterparts (male ZZ - female$_{SR}$ ZZ; pMCMC = `r pmcmc.geno.mass.m2[1,1]`), but lower than their phenotypic counterparts (female ZW - female$_{SR}$ ZZ; pMCMC = `r pmcmc.Pheno.mass.m2[1,1]`; Table 2).The heteroscedasticity variance model was the most parsimonious ([heteroscedastic model – homoscedastic model] loo: `r pog.loo[2,1]`, SE = `r pog.loo[2,2]`), accounting for `r pog.r2[1,1]`% (95% CI:`r pog.r2[1,3]` - `r pog.r2[1,4]`) of the variation in metabolic rate.<p>

\newpage
# Tables & Figures
```{r Fig1,echo=FALSE, results='asis'}
knitr::include_graphics("./Final.Figures/FigS1.pdf")
```
Figure S1. 
\newpage
# Tables & Figures
```{r Fig1.1,echo=FALSE, results='asis'}
knitr::include_graphics("./Final.Figures/FigS2.pdf")
```
Figure S2. Comparison of log standard metabolic rate (V̇$_{02}$ mL min$^{-1}$) across log body mass (g) by sex class for *Bassiana duperreyi* (A-B) and *Pogona vitticeps* (C-D). Sex-reversed individuals  (male$_{SR}$ XX or female$_{SR}$ ZZ) are denoted by red colour, phenotypic females (female XX or female ZW) are denoted in black, phenotypic males (male XY or male ZZ) are denoted in blue. Fitted lines were obtained from predicted values from the brms model for each species and confidence bands were constructed from the SE of prediction values for each sex (A,C). Density plots above each regression plot denote the distribution in body mass (log mass) by sex for each species. To visualize how log metabolic rate changes across log body mass, panels (B and D) show the distribution of predicted metabolic rate at three areas of log body mass (mean, +1.5SD, and -1.5SD) denoted by the dash-dot line in panels A and C for each sex and species.


\newpage
Table S1. Model coefficients for testing whether sex affects the slope of standard metabolic rate for *Bassiana duperreyi*, where the intercept is concordant females. Metabolic rate and mass were log transformed and time was z-transformed. Columns l-95% CI and u-95% CI, are the lower and upper bound of the 95% credible interval for each parameter, estimated from the posterior distribution.. 
```{r TableS1,echo= FALSE}
# Tabulate the model coefficients - BASSIANA
# bring in, combined and rename tables
Bas_m1_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Bas_m1_brms_smr")
Bas_m1_table <- lazerhawk::brms_SummaryTable(Bas_m1_brms)
Bas.postior.m1.table <- Bas_m1_table 
Table1 <- Bas.postior.m1.table

# rename variables for final table
Table1[1,1] <- "Intercept (SexFemaleXX)"
Table1[2,1] <- "SexMaleSRXX"
Table1[3,1] <- "SexMaleXY"
Table1[6,1] <- "SexMaleSRXX:logMass"
Table1[7,1] <- "SexMaleXY:logMass"

# Table1 Final table
Tbl.1 <-flextable(Table1) %>% 
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() 
knitr::knit_print(Tbl.1)
```

\newpage
Table S2. Model coefficients form hetero testing whether sex affects the slope of metabolic rate for *Pogona vitticeps*, which heteroscedasticity was accounted for within the data. The intercept is concordant females. Metabolic rate and mass were log transformed and time was z-transformed. Columns l-95% CI and u-95% CI, are the lower and upper bound of the 95% credible interval for each parameter, estimated from the posterior distribution.
```{r TableS2,echo= FALSE}
# Tabulate the model coefficients - Pogona Heteroscedasticity model
Pog_m2_brms <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/SMR_mods/Pog_m2_brms_smr")
Pog_m2_table <- lazerhawk::brms_SummaryTable(Pog_m2_brms)
Table2  <- Pog_m2_table

# put random variables (sigma) at bottom
Table2 <- Table2 %>% 
  arrange(factor(Covariate, levels = c("Intercept", "sexZZf", "sexZZm", "logMass",
                                       "ztime", "sexZZf:logMass", "sexZZm:logMass",
                                       "sigma_Intercept", "sigma_logMass",
                                       "sigma_ztime")))

# rename variables for final table
Table2[1,1] <- "Intercept (SexFemaleZW)"
Table2[2,1] <- "SexFemaleSRZZ"
Table2[3,1] <- "SexMaleZZ"
Table2[6,1] <- "SexFemaleSRZZ:logMass"
Table2[7,1] <- "SexMaleZZ:logMass"

# Table2 Final table
Tbl.2 <-flextable(Table2) %>%  
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() 
knitr::knit_print(Tbl.2)
```

Table S2. Model coefficients form hetero testing whether sex affects the slope of metabolic rate for *Pogona vitticeps*, which heteroscedasticity was accounted for within the data. The intercept is concordant females. Metabolic rate and mass were log transformed and time was z-transformed. Columns l-95% CI and u-95% CI, are the lower and upper bound of the 95% credible interval for each parameter, estimated from the posterior distribution.
```{r TableS3,echo= FALSE}
# Tabulate the model coefficients - Pogona Heteroscedasticity model
Contrasts <- readRDS(file = "~/Dropbox/energy_sex_reversal/final.analysis.data/figure_2B_2D_contrast_tbl")
TableC  <-  Contrasts[,c(5,1,2,3,4)]
# Table2 Final table
Tbl.3 <-flextable(TableC) %>%  
  italic(i = 1:12, j = 1, italic = TRUE) %>%
  hline(i=6, j = 1:5, part="body") %>% 
  merge_v(j = "Species") %>%  
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() 
knitr::knit_print(Tbl.3)
```



\newpage
Table S4. BBRMS model coefficients for each respective species when testing mass differences across sex class for animals used in respirometry experiments. Mass was log-transformed and lower and upper bounds were derived from the 95% credible interval for each parameter, estimated from the posterior samples.
```{r TableS4,echo= FALSE,  warning=FALSE}
# bring in, combined and rename tables
bass.bodymass <- readRDS("~/Dropbox/energy_sex_reversal/models/Bas_bodymass")
Bassiana.mass.table <- bass.bodymass %>%
  emmeans( ~ sex ) %>%
  gather_emmeans_draws() %>%
  median_qi() %>% 
  dplyr::rename(Estimate = .value,
         "u-95% CI" = .upper,
         "l-95% CI" = .lower) %>% 
  dplyr::select(-c(.width, .interval, .point)) %>% 
  dplyr::mutate(Species = "B. duperryii") %>% 
  as.data.frame()

###### Body mass comparison with BRMS model  ######  
bass.bodymass <- readRDS("~/Dropbox/energy_sex_reversal/models/Bas_bodymass")
post_Bas_mass_m <- posterior_samples(bass.bodymass, pars = "^b")
XXf.mass <- as.array(post_Bas_mass_m[,"b_Intercept"])
XXm.mass <- as.array(XXf.mass +  post_Bas_mass_m[,"b_sexXXm"]) # sex reversed
XYm.mass <- as.array(XXf.mass +  post_Bas_mass_m[,"b_sexXYm"])

# H1: Mass of sex reversed and concordant male; pMCMC  0.45
Bass.Pheno.mass <- XXm.mass - XYm.mass
Bass.pmcmc.Pheno.mass. <- pmcmc(Bass.Pheno.mass)
# H2: Mass of sex reversed and concordant female; pMCMC  0.17
Bass.Geno.mass <-  XXm.mass - XXf.mass 
Bass.pmcmc.geno.mass <- pmcmc(Bass.Geno.mass)
# H3: Mass of concordant sexes; pMCMC  0.61
Bass.Concordant.Sex <-  XXf.mass - XYm.mass 
Bass.pmcmc.concordant.mass <- pmcmc(Bass.Concordant.Sex)
# get bassiana sample size

Bass_sample_Size <- read.csv(file = "~/Dropbox/energy_sex_reversal/final.analysis.data/growth.bassiana.pogona.csv") %>% 
  dplyr::rename(sex = Geno.pheno) %>% 
  filter(Species == "Bassiana") %>% 
  group_by(sex) %>% 
  summarise("Sample Size" = n()) %>% 
  # pd estimates from pairwise comparisons XXm-XYm = 0.45; XXf-XXm = 0.17; XYm-XXf = 0.61
  mutate("Contrast" = c("Female XX-MaleSR XX","MaleSR XX-Male XY", "Male XY-Female XX"), 
         "pMCMC Value" = c("0.45", "0.91", "0.70"))
# bass final table
Bassiana.mass.table <- cbind(Bass_sample_Size, Bassiana.mass.table)


#####
# pogona
#####
pog.bodymass <- readRDS("~/Dropbox/energy_sex_reversal/models/Pog_bodymass")
Pogona.mass.table <- pog.bodymass %>%
  emmeans( ~ sex ) %>%
  gather_emmeans_draws() %>%
  median_qi() %>% 
  dplyr::rename(Estimate = .value,
         "u-95% CI" = .upper,
         "l-95% CI" = .lower) %>% 
  dplyr::select(-c(.width, .interval, .point)) %>% 
  dplyr::mutate(Species = "P. vitticeps") %>% 
  as.data.frame()
###### Body mass comparison with BRMS model  ######  
pog.bodymass <- readRDS("~/Dropbox/energy_sex_reversal/models/Pog_bodymass")
post_Pog_mass_m <- posterior_samples(pog.bodymass, pars = "^b")
ZWf.mass <- as.array(post_Pog_mass_m[,"b_Intercept"])
ZZf.mass <- as.array(ZWf.mass +  post_Pog_mass_m[,"b_sexZZf"]) # sex reversed
ZZm.mass <- as.array(ZWf.mass +  post_Pog_mass_m[,"b_sexZZm"])

# H1: Mass of sex reversed and concordant females; pMCMC  0.48
Pog.Pheno.mass <- ZWf.mass - ZZf.mass
pmcmc.Pheno.mass. <- pmcmc(Pog.Pheno.mass)
# H2: Mass of sex reversed and concordant males; pMCMC  0.44
Pog.Geno.mass <-  ZZm.mass - ZZf.mass 
pmcmc.geno.mass <- pmcmc(Pog.Geno.mass)
# H3: Mass of concordant sexes; pMCMC  0.96
Pog.Concordant.mass <-  ZWf.mass - ZZm.mass 
pmcmc.concordant.mass <- pmcmc(Pog.Concordant.mass)

# get sample size info
Pog_sample_Size <- read.csv(file = "~/Dropbox/energy_sex_reversal/final.analysis.data/growth.bassiana.pogona.csv") %>%
  dplyr::rename(sex = Geno.pheno) %>% 
  filter(Species == "Pogona") %>% 
  group_by(sex) %>% 
  summarise("Sample Size" = n()) %>% 
  # pd estimates from pairwise comparisons ZWf -ZZf = .76; ZZf - ZZm = 0.78; ZZm - ZWf = 0.5
  mutate("Contrast" = c("Female ZW-FemaleSR ZZ","FemaleSR ZZ-Male ZZ", "Male ZZ-Female ZW"), 
         "pMCMC Value" = c("0.48", "0.44", "0.96"))
#Pogona final table
Pogona.mass.table <- cbind(Pog_sample_Size, Pogona.mass.table) 

# final table
TableS1 <- rbind(Bassiana.mass.table, Pogona.mass.table) 
TableS1  <-  TableS1[,c(9,2,6,7,8,3,4)]
TableS1 = TableS1 %>% 
  mutate(Sex = c("Female XX","MaleSR XX","Male XY","Female ZW","FemaleSR ZZ", "Male ZZ"))
TableS1  <-  TableS1[,c(1,8,2,3,4,5,6,7)]
TableS1 <- TableS1 %>% mutate_at(vars("Estimate","l-95% CI", "u-95% CI" ), funs(round(., 2))) 

# Tbl 1 final table for word
Tbl.S1 <-flextable(TableS1) %>% 
  italic(i = 1:6, j = 1, italic = TRUE) %>%
  hline(i=3, j = 1:8, part="body") %>% 
  merge_v(j = "Species") %>%  
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() %>% 
  set_table_properties(layout = "autofit") %>% 
  fontsize(i = NULL, j = NULL, size = 10, part = "body")
knitr::knit_print(Tbl.S1)
```

\newpage
Table S5. BRMS Model coefficients for SVL and mass growth rate estimates across sex class *Bassiana duperreyi*. Growth rate was calculated by dividing the change in growth (SVL or mass) between the initial measurement and subsequent remeasurement by the total number of days elapsed. Due to the small size and rate of change in grams, mass was converted to centigrams (cg). Animals were remeasured between 3 and 6 months post hatch.
```{r TableS5, echo=FALSE}
###
# Bassiana Growth
# 1) SVL
Bass.svl.mod <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/Bass_growth_svl_metabolism")
Bass.svl.tbl <- lazerhawk::brms_SummaryTable(Bass.svl.mod)
Bass.svl.tbl[1,1] <- "Intercept (O2_SexFemaleXX)"
Bass.svl.tbl[2,1] <- "Growth Rate (SVLmm)"
Bass.svl.tbl[3,1] <- "O2_SexMaleSRXX"
Bass.svl.tbl[4,1] <- "O2_SexMaleXY"
Bass.svl.tbl[5,1] <- "Growth Rate (SVLmm):O2_SexMaleSRXX"
Bass.svl.tbl[6,1] <- "Growth Rate (SVLmm):O2_SexMaleXY"
Bass.svl.tbl <- Bass.svl.tbl %>% mutate("Species" = "B. duperreyi", "Growth rate" = "SVL(mm/d)")

#2) MASS
Bass.Mass.mod <- readRDS(file = "~/Dropbox/energy_sex_reversal/models/Bass_growth_mass_metabolism")
Bass.mass.tbl <- lazerhawk::brms_SummaryTable(Bass.Mass.mod)
Bass.mass.tbl[1,1] <- "Intercept (O2_SexFemaleXX)"
Bass.mass.tbl[2,1] <- "Growth Rate (mass cg/d)"
Bass.mass.tbl[3,1] <- "O2_SexMaleSRXX"
Bass.mass.tbl[4,1] <- "O2_SexMaleXY"
Bass.mass.tbl[5,1] <- "Growth Rate (mass cg/d):O2_SexMaleSRXX"
Bass.mass.tbl[6,1] <- "Growth Rate (mass cg/d):O2_SexMaleXY"
Bass.mass.tbl <- Bass.mass.tbl %>% mutate("Species" = "B. duperreyi", "Growth rate" = "mass(cg/d)")

### 
# final table
tables4 <- rbind(Bass.svl.tbl, Bass.mass.tbl) 
TableS4 <- tables4[,c(7,1,2,4,5)]
Tbl.S4 <- flextable(TableS4) %>% 
  italic(i = 1:12, j = 1, italic = TRUE) %>% 
  merge_v(j = c("Growth rate")) %>%  
  hline(i=c(6), j = 1:5, part="body") %>% 
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() %>% 
  fontsize(i = NULL, j = NULL, size = 10, part = "body")
knitr::knit_print(Tbl.S4)

```

\newpage
Table S6. BRMS Model coefficients for SVL and mass growth rate estimates across sex class for *Pogona vitticeps*. Growth rate was calculated by dividing the change in growth (SVL or mass) between the initial measurement and subsequent remeasurement by the total number of days elapsed. Animals were remeasured between 3 and 6 months post hatch.
```{r TableS6, echo=FALSE}
###
# Pogona growth
# 1) SVL
Pog.svl.mod <- readRDS(file ="~/Dropbox/energy_sex_reversal/models/Pog_growth_svl_metabolism")
Pog.svl.tbl <- lazerhawk::brms_SummaryTable(Pog.svl.mod)
Pog.svl.tbl[1,1] <- "Intercept (O2_SexFemaleZW)"
Pog.svl.tbl[2,1] <- "Growth Rate (SVLmm)"
Pog.svl.tbl[3,1] <- "O2_SexFemaleSRZZ"
Pog.svl.tbl[4,1] <- "O2_SexMaleZZ"
Pog.svl.tbl[5,1] <- "Growth Rate (SVLmm):O2_SexFemaleSRZZ"
Pog.svl.tbl[6,1] <- "Growth Rate (SVLmm):O2_SexMaleZZ"
Pog.svl.tbl <- Pog.svl.tbl %>% mutate("Species" = "P. vitticeps", "Growth rate" = "SVL(mm/d)")

# 2) MASS
Pog.Mass.mod <- readRDS(file ="~/Dropbox/energy_sex_reversal/models/Pog_growth_mass_metabolism")
Pog.mass.tbl <- lazerhawk::brms_SummaryTable(Pog.Mass.mod)
Pog.mass.tbl[1,1] <- "Intercept (O2_SexFemaleZW)"
Pog.mass.tbl[2,1] <- "Growth Rate (mass g/d)"
Pog.mass.tbl[3,1] <- "O2_SexFemaleSRZZ"
Pog.mass.tbl[4,1] <- "O2_SexMaleZZ"
Pog.mass.tbl[5,1] <- "Growth Rate (mass g/d):O2_SexFemaleSRZZ"
Pog.mass.tbl[6,1] <- "Growth Rate (mass g/d):O2_SexMaleZZ"
Pog.mass.tbl <- Pog.mass.tbl %>% mutate("Species" = "P. vitticeps", "Growth rate" = "mass(g/d)")

### 
# final table
tables5 <- rbind(Pog.svl.tbl, Pog.mass.tbl)
Tables5 <- tables5[,c(7,1,2,4,5)]
Tbl.s5 <- flextable(Tables5) %>% 
  italic(i = 1:12, j = 1, italic = TRUE) %>% 
  merge_v(j = c("Growth rate")) %>%  
  hline(i=c(6), j = 1:5, part="body") %>% 
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() %>% 
  fontsize(i = NULL, j = NULL, size = 10, part = "body")
knitr::knit_print(Tbl.s5)
``` 

\newpage
Table S7. Frequency of mortality across sex class for *Bassiana duperryii* and *Pogona vitticeps*. These measurements were recorded from initial hatch date to 6 months post-hatch date. 
```{r TableS7,echo= FALSE}
growth <- read.csv(file = "~/Dropbox/energy_sex_reversal/final.analysis.data/growth.bassiana.pogona.csv") %>% 
  dplyr::rename(sex = Geno.pheno)
bassiana.growth <- growth %>% 
  filter(Species == "Bassiana")
pogona.growth <- growth %>% 
  filter(Species == "Pogona")
# bass.table
Bassiana.surv.table <- table(bassiana.growth$Dead.Y.N., bassiana.growth$sex) %>%  
  as.data.frame() %>% 
  mutate(Species = "B. duperryii") %>% 
  spread(Var1, Freq)
# pogona.table
pogona.surv.table <- table(pogona.growth$Dead.Y.N., pogona.growth$sex)%>%  
  as.data.frame() %>% 
  mutate(Species = "P. vitticeps") %>% 
  spread(Var1, Freq)
morality.frq <- rbind(Bassiana.surv.table, pogona.surv.table) %>% 
  dplyr::rename("Sex Class" = "Var2")
TableS7 <- morality.frq[,c(2,3,4)]
TableS7 <- TableS7 %>% 
  mutate(Sex = c("Female XX","MaleSR XX","Male XY","Female ZW","FemaleSR ZZ", "Male ZZ"))
TableS7 <- TableS7[,c(1,4,2,3)]

# final table
Tbl.S7 <-flextable(TableS7) %>% 
  italic(i = 1:6, j = 1, italic = TRUE) %>% 
  hline(i=3, j = 1:4, part="body") %>% 
  merge_v(j = "Species") %>%  
  autofit(part = "all") %>% 
  align(align ="center", part = "all") %>% 
  font(part = "all", fontname = "Times New Roman") %>% 
  fix_border_issues() 
knitr::knit_print(Tbl.S7)
``` 
